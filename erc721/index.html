<body id="itrf">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link
    href="https://cdn.jsdelivr.net/npm/daisyui@4.10.2/dist/full.min.css"
    rel="stylesheet"
    type="text/css"
  />
  <link href="./output.css" rel="stylesheet" />
  <section
    data-theme="dark"
    class="mt-20 flex items-center flex-col gap-10 min-h-screen bg-base-100"
  >
    <h1 class="text-center text-3xl font-extrabold text-white">
      Soulbound Token (ERC721)
    </h1>
    <div role="tablist" class="tabs tabs-boxed">
      <a
        role="tab"
        id="nft-tab"
        class="tab tab-active transition-all duration-200"
      >
        All NFT
      </a>
    </div>
    <div
      id="nft-card"
      class="mx-auto px-[20px] max-w-[1170px] grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"
    >
      <div class="card max-w-[320px] bg-base-100 shadow-xl">
        <figure>
          <img
            src="https://ipfs.io/ipfs/QmVz3daa73dpz3vJrjmYGRZYgf2JFGHTZ7mMsfPwfKkZyu/1.jpg"
            alt="Shoes"
            class="max-h-[250px] w-full object-cover"
          />
        </figure>
        <div class="card-body">
          <h2 class="card-title">Sber Blockchain Hackathon 2023 Diploma!</h2>
          <p>
            Some description i love it really, daisy ui is amazing tailwind css
            lib to make beatifull
          </p>
          <div class="card-actions justify-end">
            <button class="btn btn-primary">Show more</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.12.1/ethers.umd.min.js"
    type="application/javascript"
  ></script>
  <script>
    const abi = [
      {
        inputs: [
          {
            internalType: "string",
            name: "_name",
            type: "string",
          },
          {
            internalType: "string",
            name: "_symbol",
            type: "string",
          },
        ],
        stateMutability: "payable",
        type: "constructor",
      },
      {
        anonymous: false,
        inputs: [
          {
            indexed: true,
            internalType: "address",
            name: "user",
            type: "address",
          },
          {
            indexed: true,
            internalType: "address",
            name: "newOwner",
            type: "address",
          },
        ],
        name: "OwnershipTransferred",
        type: "event",
      },
      {
        anonymous: false,
        inputs: [
          {
            indexed: true,
            internalType: "address",
            name: "from",
            type: "address",
          },
          {
            indexed: true,
            internalType: "address",
            name: "to",
            type: "address",
          },
          {
            indexed: true,
            internalType: "uint256",
            name: "id",
            type: "uint256",
          },
        ],
        name: "Transfer",
        type: "event",
      },
      {
        inputs: [
          {
            internalType: "address",
            name: "owner",
            type: "address",
          },
        ],
        name: "balanceOf",
        outputs: [{ internalType: "uint256", name: "", type: "uint256" }],
        stateMutability: "view",
        type: "function",
      },
      {
        inputs: [
          {
            internalType: "uint256",
            name: "id",
            type: "uint256",
          },
        ],
        name: "burn",
        outputs: [],
        stateMutability: "payable",
        type: "function",
      },
      {
        inputs: [],
        name: "name",
        outputs: [{ internalType: "string", name: "", type: "string" }],
        stateMutability: "view",
        type: "function",
      },
      {
        inputs: [],
        name: "owner",
        outputs: [{ internalType: "address", name: "", type: "address" }],
        stateMutability: "view",
        type: "function",
      },
      {
        inputs: [
          {
            internalType: "uint256",
            name: "id",
            type: "uint256",
          },
        ],
        name: "ownerOf",
        outputs: [
          {
            internalType: "address",
            name: "owner",
            type: "address",
          },
        ],
        stateMutability: "view",
        type: "function",
      },
      {
        inputs: [
          {
            internalType: "address[]",
            name: "to",
            type: "address[]",
          },
          {
            internalType: "string[]",
            name: "uris",
            type: "string[]",
          },
        ],
        name: "safeBatchMint",
        outputs: [],
        stateMutability: "payable",
        type: "function",
      },
      {
        inputs: [
          {
            internalType: "address",
            name: "to",
            type: "address",
          },
          { internalType: "string", name: "uri", type: "string" },
        ],
        name: "safeMint",
        outputs: [],
        stateMutability: "payable",
        type: "function",
      },
      {
        inputs: [
          {
            internalType: "bytes4",
            name: "interfaceId",
            type: "bytes4",
          },
        ],
        name: "supportsInterface",
        outputs: [{ internalType: "bool", name: "", type: "bool" }],
        stateMutability: "view",
        type: "function",
      },
      {
        inputs: [],
        name: "symbol",
        outputs: [{ internalType: "string", name: "", type: "string" }],
        stateMutability: "view",
        type: "function",
      },
      {
        inputs: [
          {
            internalType: "uint256",
            name: "tokenId",
            type: "uint256",
          },
        ],
        name: "tokenURI",
        outputs: [{ internalType: "string", name: "", type: "string" }],
        stateMutability: "view",
        type: "function",
      },
      {
        inputs: [
          {
            internalType: "address",
            name: "newOwner",
            type: "address",
          },
        ],
        name: "transferOwnership",
        outputs: [],
        stateMutability: "payable",
        type: "function",
      },
    ];

    const privateKey =
      "0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80";
    const provider = ethers.getDefaultProvider("http://localhost:8545/");

    const contractAddress = "0x5fbdb2315678afecb367f032d93f642f64180aa3";
    const walletWithProvider = new ethers.Wallet(privateKey, provider);

    const contract = new ethers.Contract(contractAddress, abi, provider);
    const connectContract = contract.connect(walletWithProvider);
    const safeMint = async () => {
      await connectContract.safeMint(walletWithProvider, "");
    };
    const getContractEvents = async () => {
      const filter = await connectContract.queryFilter("Transfer");

      filter.forEach(async (event) => {
        const topics = event.topics;
        const topicToWallet = topics[2].slice(-40);
        // topicToWallet === walletWithProvider.address.slice(-40).toLowerCase()
        console.log(await connectContract.tokenURI(topics[3]));
      });
    };

    getContractEvents();
  </script>
</body>
